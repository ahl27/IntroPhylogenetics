<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="IntroPhylogenetics">
<title>ComparingTrees • IntroPhylogenetics</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ComparingTrees">
<meta property="og:description" content="IntroPhylogenetics">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">IntroPhylogenetics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="https://www.ahl27.com/IntroPhylogenetics/articles/IntroPhylogenetics.html">Overview</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-lessons">Lessons</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-lessons">
    <a class="dropdown-item" href="https://www.ahl27.com/IntroPhylogenetics/articles/BuildingTrees.html">Building Trees</a>
    <a class="dropdown-item" href="https://www.ahl27.com/IntroPhylogenetics/articles/ComparingTrees.html">Comparing Trees</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.ahl27.com/tutorials">Back to Website</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ahl27/IntroPhylogenetics" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.ahl27.com" aria-label="My Website">
    <span class="fa fa-potato"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>ComparingTrees</h1>
                        <h4 data-toc-skip class="author">Aidan
Lakshman<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="mailto:ahl27@pitt.edu" class="email"&gt;ahl27@pitt.edu&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>
</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ahl27/IntroPhylogenetics/blob/HEAD/vignettes/ComparingTrees.Rmd" class="external-link"><code>vignettes/ComparingTrees.Rmd</code></a></small>
      <div class="d-none name"><code>ComparingTrees.Rmd</code></div>
    </div>

    
    
<p>Making trees is nice, but how do we compare them? Comparing trees is
a difficult problem, since they can contain significantly different
topologies.</p>
<p>In this discussion I’ll cover two common ways of calculating
distances between trees: Robinson-Foulds (RF) Distance and
Kuhner-Felsenstein (KF) distance.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Package imports</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DECIPHER</span><span class="op">)</span>

<span class="co"># Helper plotting function</span>
<span class="va">plot_tree_unrooted</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dend</span>, <span class="va">title</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/DECIPHER/man/WriteDendrogram.html" class="external-link">WriteDendrogram</a></span><span class="op">(</span><span class="va">dend</span>, file<span class="op">=</span><span class="va">tf</span>, quoteLabels<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">predTree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span><span class="va">tf</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">predTree</span>, <span class="st">'unrooted'</span>, main<span class="op">=</span><span class="va">title</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We’ll start with a slightly larger test dataset so that we can more
clearly see differences between tree constructions. The following
codeblocks read in a set of 25 simulated alignments, then constructs
phylogenetic trees using the three methods discussed previously.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># External data file, contains simulated alignment</span>
<span class="va">simSeqsFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata'</span>, <span class="st">'Simulated_v1.fas'</span>, package<span class="op">=</span><span class="st">'IntroPhylogenetics'</span>, mustWork<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">simAli</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/XStringSet-io.html" class="external-link">readDNAStringSet</a></span><span class="op">(</span><span class="va">simSeqsFile</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">simAli</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">25</span>
<span class="va">simDm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DECIPHER/man/DistanceMatrix.html" class="external-link">DistanceMatrix</a></span><span class="op">(</span><span class="va">simAli</span>, type<span class="op">=</span><span class="st">'dist'</span>, penalizeGapGapMatches<span class="op">=</span><span class="cn">FALSE</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="va">UPGMAtree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">as.dendrogram</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">simDm</span>, method<span class="op">=</span><span class="st">'average'</span><span class="op">)</span><span class="op">)</span>
<span class="va">NJtree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DECIPHER/man/TreeLine.html" class="external-link">TreeLine</a></span><span class="op">(</span><span class="va">simAli</span>, myDistMatrix<span class="op">=</span><span class="va">simDm</span>, method<span class="op">=</span><span class="st">'NJ'</span><span class="op">)</span>
<span class="va">MPtree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DECIPHER/man/TreeLine.html" class="external-link">TreeLine</a></span><span class="op">(</span><span class="va">simAli</span>, myDistMatrix<span class="op">=</span><span class="va">simDm</span>, method<span class="op">=</span><span class="st">'MP'</span><span class="op">)</span></code></pre></div>
<p>Visualizing the trees we’ve made:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_tree_unrooted</span><span class="op">(</span><span class="va">UPGMAtree</span>, <span class="st">'UPGMA'</span><span class="op">)</span></code></pre></div>
<p><img src="ComparingTrees_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_tree_unrooted</span><span class="op">(</span><span class="va">NJtree</span>, <span class="st">'NJ'</span><span class="op">)</span></code></pre></div>
<p><img src="ComparingTrees_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_tree_unrooted</span><span class="op">(</span><span class="va">MPtree</span>, <span class="st">'MP'</span><span class="op">)</span></code></pre></div>
<p><img src="ComparingTrees_files/figure-html/unnamed-chunk-2-3.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="partitions">Partitions<a class="anchor" aria-label="anchor" href="#partitions"></a>
</h2>
<p>Before we dive into tree distances, it’s important to understand the
concept of partitions. In a bifurcating unrooted tree, every edge
divides the set of leaf nodes into two sets. These form the basis of
many tree comparison algorithms. Let’s look at a toy example:</p>
<p><img src="part1.png"></p>
<p>Note how each numbered edge of the tree splits the labeled leaf nodes
into two distinct groups to either side of it. Leaf edges trivially
split the tree into a partition of just the leaf and everything else,
but internal edges split the leaves into more interesting
partitions.</p>
</div>
<div class="section level2">
<h2 id="rf-distance">RF Distance<a class="anchor" aria-label="anchor" href="#rf-distance"></a>
</h2>
<p>Robinson-Foulds (RF) distance measures the similarity of these
partitions in a tree. Let’s look at a toy example with two small trees
and their internal partitions labeled (internal edges circled in
green):</p>
<p><img src="part2.png"></p>
<p>Now let <span class="math inline">\(A\)</span> be the number of
partitions unique to the first tree, and <span class="math inline">\(B\)</span> the number of partitions unique to the
second tree. The RF distance (also called the symmetric difference
metric) is simply the quantity <span class="math inline">\((A+B)\)</span>.</p>
<p>For this example, note that edge 2 is an identical partition to edge
II. Thus, the first tree has one unique partition, and the second tree
has one unique partition, so the RF distance is <span class="math inline">\(1+1=2\)</span>.</p>
<p>Some implementations change the metric slightly by scaling it, either
by dividing by two or scaling the metric to have a maximum value of 1.
The latter operation can be done by dividing by the maximum possible
score, which is just the sum of the total number of branches. In this
case, the total number of internal branches is 4 (2 from each tree), so
the RF distance is <span class="math inline">\(0.5\)</span>.</p>
<div class="section level3">
<h3 id="r-implementation">R implementation<a class="anchor" aria-label="anchor" href="#r-implementation"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">RF_dist_external</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dend1</span>, <span class="va">dend2</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/DECIPHER/man/WriteDendrogram.html" class="external-link">WriteDendrogram</a></span><span class="op">(</span><span class="va">dend1</span>, file<span class="op">=</span><span class="va">tf</span>, quoteLabels<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">predTree1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span><span class="va">tf</span><span class="op">)</span>
  
  <span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/DECIPHER/man/WriteDendrogram.html" class="external-link">WriteDendrogram</a></span><span class="op">(</span><span class="va">dend2</span>, file<span class="op">=</span><span class="va">tf</span>, quoteLabels<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">predTree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span><span class="va">tf</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/dist.topo.html" class="external-link">dist.topo</a></span><span class="op">(</span><span class="va">predTree1</span>, <span class="va">predTree2</span>, <span class="st">'PH85'</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">RF_dist_external</span><span class="op">(</span><span class="va">UPGMAtree</span>, <span class="va">NJtree</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##       tree1</span>
<span class="co">## tree2    12</span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">RF_dist_external</span><span class="op">(</span><span class="va">UPGMAtree</span>, <span class="va">MPtree</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##       tree1</span>
<span class="co">## tree2    20</span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">RF_dist_external</span><span class="op">(</span><span class="va">NJtree</span>, <span class="va">MPtree</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##       tree1</span>
<span class="co">## tree2    12</span></code></pre>
</div>
<div class="section level3">
<h3 id="drawbacks">Drawbacks<a class="anchor" aria-label="anchor" href="#drawbacks"></a>
</h3>
<p>RF distance is widely used, but has some common issues that should be
kept in mind while using it:</p>
<ul>
<li>Lacks sensitivity
<ul>
<li>Similar trees can receive the same value</li>
<li>Range of values depends on tree shape</li>
<li>Doesn’t look at branch length</li>
</ul>
</li>
<li>Can’t recognize similar clades (any difference increases distance
score)</li>
<li>Original implementation assumes bifurcating, unrooted tree with same
leaf set</li>
<li>Distance is not immediately statistically interpretable (larger
<span class="math inline">\(\neq\)</span> significant)</li>
</ul>
<p>Some of these drawbacks have been accounted for with subsequent
optimization, and ‘generalized RF distances’ have been created that can
account for similar sets while working on multifurcating trees with
different leaf sets.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="kf-distance">KF Distance<a class="anchor" aria-label="anchor" href="#kf-distance"></a>
</h2>
<p>The Kuhner-Felsenstein (KF) distance attempts to incorporate branch
lengths into the RF distance to gain a richer description of the
differences between two trees.</p>
<p>Recall that the RF distance is the number of unique (non-shared)
partitions in the tree. The KF distance is instead taken as the sum of
the squared difference of branch lengths for each equivalent partition
in the two trees. If a partition is a unique to a particular tree, it is
taken as having a branch length of 0 in the other tree. Below is an
updated version of our previous example with branch lengths added in
pink (partitions labeled):</p>
<p><img src="part3.png"></p>
<p>Here we will also examine the leaf branches, but since the leaf set
is the same and branch lengths are identical, all of these branches
cancel each other out. One pair of branches is an equivalent partition
(2 and II), and the other two are unique. The KF distance is then:</p>
<p><span class="math display">\[\begin{align*}
KF(Tr1, Tr2) &amp;= (len(1) - 0)^2 + (0 - len(I))^2 + (len(2) -
len(II))^2 \\
&amp;= (2-0)^2 + (0-6)^2 + (2-3)^2 \\
&amp;= 41
\end{align*}\]</span></p>
<p>The advantages of this over RF distance is that it can incorporate
branch lengths in addition to topology, which allows it to downweight
small differences in topology and upweight large differences.</p>
<div class="section level3">
<h3 id="r-implementation-1">R Implementation<a class="anchor" aria-label="anchor" href="#r-implementation-1"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">KF_dist_external</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dend1</span>, <span class="va">dend2</span><span class="op">)</span><span class="op">{</span>
  <span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/DECIPHER/man/WriteDendrogram.html" class="external-link">WriteDendrogram</a></span><span class="op">(</span><span class="va">dend1</span>, file<span class="op">=</span><span class="va">tf</span>, quoteLabels<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">predTree1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span><span class="va">tf</span><span class="op">)</span>
  
  <span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/DECIPHER/man/WriteDendrogram.html" class="external-link">WriteDendrogram</a></span><span class="op">(</span><span class="va">dend2</span>, file<span class="op">=</span><span class="va">tf</span>, quoteLabels<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">predTree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span><span class="va">tf</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/dist.topo.html" class="external-link">dist.topo</a></span><span class="op">(</span><span class="va">predTree1</span>, <span class="va">predTree2</span>, method<span class="op">=</span><span class="st">'score'</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">RF_dist_external</span><span class="op">(</span><span class="va">UPGMAtree</span>, <span class="va">NJtree</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##       tree1</span>
<span class="co">## tree2    12</span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">RF_dist_external</span><span class="op">(</span><span class="va">UPGMAtree</span>, <span class="va">MPtree</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##       tree1</span>
<span class="co">## tree2    20</span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">RF_dist_external</span><span class="op">(</span><span class="va">NJtree</span>, <span class="va">MPtree</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##       tree1</span>
<span class="co">## tree2    12</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="other-metrics">Other Metrics<a class="anchor" aria-label="anchor" href="#other-metrics"></a>
</h2>
<p>These are two commonly used metrics, but many more are implemented in
the <code>TreeDist</code> package. Notable recent tree distance measures
include:</p>
<ul>
<li>
<code>TreeDist::TreeDistance</code> methods, using generalized RF
distance from Smith (2020)</li>
<li>
<code>TreeDist::JaccardRobinsonFoulds</code> and
<code>TreeDist:NyeSimilarity</code>, both generalized RF distances.</li>
<li>
<code>TreeDist::KendallColijn</code>, a distance that measures
difference in path lengths between pairs of leaves</li>
<li>
<code>TreeDist::MASTSize</code>, a distance that measures the
largest agreement subtree between two trees</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="manual-implementations">Manual Implementations<a class="anchor" aria-label="anchor" href="#manual-implementations"></a>
</h2>
<p>I wrote implementations of both distances from scratch to illustrate
how these functions are working under the hood. Note that external
packages incorporate some optimizations I didn’t implement that lead to
different results.</p>
<div class="section level3">
<h3 id="helper-functions">Helper functions<a class="anchor" aria-label="anchor" href="#helper-functions"></a>
</h3>
<p>This code block contains several helper functions used later.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">flatdendrapply</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dend</span>, <span class="va">NODEFUN</span>, <span class="va">LEAFFUN</span><span class="op">=</span><span class="va">NODEFUN</span>, <span class="va">INCLUDEROOT</span><span class="op">=</span><span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span>
  <span class="co">## Applies a function to each node (internal and leaf) of the tree</span>
  <span class="co">## Returns a flat list</span>
  <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">dend</span>, 
                \<span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
                  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">'leaf'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
                    <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">NODEFUN</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span>
                    <span class="kw">for</span> <span class="op">(</span> <span class="va">child</span> <span class="kw">in</span> <span class="va">x</span> <span class="op">)</span> <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">v</span>, <span class="fu"><a href="https://rdrr.io/r/base/Recall.html" class="external-link">Recall</a></span><span class="op">(</span><span class="va">child</span><span class="op">)</span><span class="op">)</span>
                    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span>
                  <span class="op">}</span> 
                  <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">is</span><span class="op">(</span><span class="va">LEAFFUN</span>, <span class="st">'function'</span><span class="op">)</span><span class="op">)</span>
                    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
                  <span class="kw">else</span> 
                    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">LEAFFUN</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
                <span class="op">}</span>
  <span class="op">)</span>
  <span class="va">retval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">val</span>, recursive<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">INCLUDEROOT</span><span class="op">)</span>
    <span class="va">retval</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">retval</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">isLeaf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dendNode</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">dendNode</span>, <span class="st">'leaf'</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">dendNode</span>, <span class="st">'leaf'</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">equivPart</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">set1</span>, <span class="va">set2</span>, <span class="va">fullset</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Checks if two partitions are equivalent</span>
  <span class="va">inverseset1</span> <span class="op">&lt;-</span> <span class="va">fullset</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">fullset</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">set1</span><span class="op">)</span><span class="op">]</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setequal</a></span><span class="op">(</span><span class="va">set1</span>,<span class="va">set2</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setequal</a></span><span class="op">(</span><span class="va">inverseset1</span>, <span class="va">set2</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">get_branch_length</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dendNode</span><span class="op">)</span><span class="op">{</span>
  <span class="co">## Helper function for KF distance, gets partition and branch length</span>
  <span class="co">## of all branches Because of weirdness each node will return two values,</span>
  <span class="co">## the result just needs some slight post-processing </span>
  <span class="co">## (see KF_Distance function for example)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu">isLeaf</span><span class="op">(</span><span class="va">dendNode</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">dendNode</span>, <span class="st">'height'</span><span class="op">)</span>
  <span class="va">n1</span> <span class="op">&lt;-</span> <span class="va">dendNode</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="va">n2</span> <span class="op">&lt;-</span> <span class="va">dendNode</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
  <span class="va">c1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">n1</span>, <span class="st">'height'</span><span class="op">)</span>
  <span class="va">c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">n2</span>, <span class="st">'height'</span><span class="op">)</span>
  
  <span class="kw">if</span><span class="op">(</span><span class="fu">isLeaf</span><span class="op">(</span><span class="va">n1</span><span class="op">)</span><span class="op">)</span>
    <span class="va">labs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">n1</span>, <span class="st">'label'</span><span class="op">)</span>
  <span class="kw">else</span> 
    <span class="va">labs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">n1</span><span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="fu">isLeaf</span><span class="op">(</span><span class="va">n2</span><span class="op">)</span><span class="op">)</span>
    <span class="va">labs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">n2</span>, <span class="st">'label'</span><span class="op">)</span>
  <span class="kw">else</span>
    <span class="va">labs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">n2</span><span class="op">)</span>

  <span class="va">l1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>length<span class="op">=</span><span class="va">h</span><span class="op">-</span><span class="va">c1</span>, part<span class="op">=</span><span class="va">labs1</span><span class="op">)</span>
  <span class="va">l2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>length<span class="op">=</span><span class="va">h</span><span class="op">-</span><span class="va">c2</span>, part<span class="op">=</span><span class="va">labs2</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">l1</span>, <span class="va">l2</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="robinson-foulds-distance">Robinson-Foulds Distance<a class="anchor" aria-label="anchor" href="#robinson-foulds-distance"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">RF_Distance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dend1</span>, <span class="va">dend2</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Get all partitions</span>
  <span class="va">part1</span> <span class="op">&lt;-</span> <span class="fu">flatdendrapply</span><span class="op">(</span><span class="va">dend1</span>, <span class="va">unlist</span>, <span class="cn">NULL</span><span class="op">)</span>
  <span class="va">part2</span> <span class="op">&lt;-</span> <span class="fu">flatdendrapply</span><span class="op">(</span><span class="va">dend2</span>, <span class="va">unlist</span>, <span class="cn">NULL</span><span class="op">)</span>
  <span class="va">allmembers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">dend1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">dend2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># Calculate tree distance</span>
  <span class="va">A</span> <span class="op">&lt;-</span> <span class="va">B</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">part1</span><span class="op">)</span><span class="op">)</span>
    <span class="va">A</span> <span class="op">&lt;-</span> <span class="va">A</span> <span class="op">+</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">part2</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">equivPart</span><span class="op">(</span><span class="va">part1</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">x</span>, <span class="va">allmembers</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">part2</span><span class="op">)</span><span class="op">)</span>
    <span class="va">B</span> <span class="op">&lt;-</span> <span class="va">B</span> <span class="op">+</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">part1</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">equivPart</span><span class="op">(</span><span class="va">part2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">x</span>, <span class="va">allmembers</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># This implementation normalizes to get a distance out of 1</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">(</span><span class="va">A</span><span class="op">+</span><span class="va">B</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">part1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">part2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="kuhner-felsenstein-distance">Kuhner-Felsenstein Distance<a class="anchor" aria-label="anchor" href="#kuhner-felsenstein-distance"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">KF_Distance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dend1</span>, <span class="va">dend2</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># Get all branch lengths and partitions</span>
  <span class="va">part1</span> <span class="op">&lt;-</span> <span class="fu">flatdendrapply</span><span class="op">(</span><span class="va">dend1</span>, <span class="va">get_branch_length</span>, <span class="cn">NULL</span><span class="op">)</span>
  <span class="va">part2</span> <span class="op">&lt;-</span> <span class="fu">flatdendrapply</span><span class="op">(</span><span class="va">dend2</span>, <span class="va">get_branch_length</span>, <span class="cn">NULL</span><span class="op">)</span>
  
  <span class="co"># Each function call returns a length of list two, we just want the members</span>
  <span class="va">part1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">part1</span>, recursive<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">part2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">part2</span>, recursive<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  
  <span class="co"># Root is split into two branches, need to combine</span>
  <span class="va">part1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">length</span> <span class="op">&lt;-</span> <span class="va">part1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">length</span> <span class="op">+</span> <span class="va">part1</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">length</span>
  <span class="va">part2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">length</span> <span class="op">&lt;-</span> <span class="va">part2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">length</span> <span class="op">+</span> <span class="va">part2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">length</span>
  <span class="va">part1</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">part2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  
  <span class="va">allmembers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">dend1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">dend2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># For each</span>
  <span class="va">treedist</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">part1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">part2</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">equivPart</span><span class="op">(</span><span class="va">part1</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">part</span>, <span class="va">x</span><span class="op">$</span><span class="va">part</span>, <span class="va">allmembers</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">check</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="va">loc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">check</span><span class="op">)</span>
      <span class="va">treedist</span> <span class="op">&lt;-</span> <span class="va">treedist</span> <span class="op">+</span> <span class="op">(</span><span class="va">part1</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">length</span> <span class="op">-</span> <span class="va">part2</span><span class="op">[[</span><span class="va">loc</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">length</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span>
    <span class="op">}</span>
  <span class="op">}</span>
  <span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">part2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">part1</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">equivPart</span><span class="op">(</span><span class="va">part2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">part</span>, <span class="va">x</span><span class="op">$</span><span class="va">part</span>, <span class="va">allmembers</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">check</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="va">loc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">check</span><span class="op">)</span>
      <span class="va">treedist</span> <span class="op">&lt;-</span> <span class="va">treedist</span> <span class="op">+</span> <span class="op">(</span><span class="va">part2</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">length</span> <span class="op">-</span> <span class="va">part1</span><span class="op">[[</span><span class="va">loc</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">length</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span>
    <span class="op">}</span>
  <span class="op">}</span>
  
  <span class="co">## divided by two since duplicates will be added twice</span>
  <span class="co">## probably worth reworking at some point to avoid adding duplicates twice,</span>
  <span class="co">## this is just a quick fix</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">treedist</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">RFDists</span> <span class="op">&lt;-</span> <span class="va">KFDists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow<span class="op">=</span><span class="fl">3</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">RFDists</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">KFDists</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">RFDists</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">KFDists</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'UPGMA'</span>, <span class="st">'NJ'</span>, <span class="st">'MP'</span><span class="op">)</span>

<span class="va">RFDists</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">RFDists</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">RF_Distance</span><span class="op">(</span><span class="va">UPGMAtree</span>, <span class="va">NJtree</span><span class="op">)</span>
<span class="va">RFDists</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">RFDists</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">RF_Distance</span><span class="op">(</span><span class="va">UPGMAtree</span>, <span class="va">MPtree</span><span class="op">)</span>
<span class="va">RFDists</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">RFDists</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">RF_Distance</span><span class="op">(</span><span class="va">NJtree</span>, <span class="va">MPtree</span><span class="op">)</span>
<span class="va">KFDists</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">KFDists</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">KF_Distance</span><span class="op">(</span><span class="va">UPGMAtree</span>, <span class="va">NJtree</span><span class="op">)</span>
<span class="va">KFDists</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">KFDists</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">KF_Distance</span><span class="op">(</span><span class="va">UPGMAtree</span>, <span class="va">MPtree</span><span class="op">)</span>
<span class="va">KFDists</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">KFDists</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">KF_Distance</span><span class="op">(</span><span class="va">NJtree</span>, <span class="va">MPtree</span><span class="op">)</span>

<span class="va">RFDists</span></code></pre></div>
<pre><code><span class="co">##           UPGMA        NJ        MP</span>
<span class="co">## UPGMA 0.0000000 0.2608696 0.4130435</span>
<span class="co">## NJ    0.2608696 0.0000000 0.2608696</span>
<span class="co">## MP    0.4130435 0.2608696 0.0000000</span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">KFDists</span></code></pre></div>
<pre><code><span class="co">##           UPGMA        NJ        MP</span>
<span class="co">## UPGMA 0.0000000 0.9712953 0.9737935</span>
<span class="co">## NJ    0.9712953 0.0000000 0.3088127</span>
<span class="co">## MP    0.9737935 0.3088127 0.0000000</span></code></pre>
<hr>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Aidan Lakshman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
